(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{511:function(e,t,o){"use strict";o.r(t);var a=o(0),r=Object(a.a)({},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h2",{attrs:{id:"chapter-9-general-programmingï¼ˆé€šç”¨ç¨‹åºè®¾è®¡ï¼‰"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#chapter-9-general-programmingï¼ˆé€šç”¨ç¨‹åºè®¾è®¡ï¼‰","aria-hidden":"true"}},[e._v("#")]),e._v(" Chapter 9. General Programmingï¼ˆé€šç”¨ç¨‹åºè®¾è®¡ï¼‰")]),e._v(" "),o("h3",{attrs:{id:"item-58-prefer-for-each-loops-to-traditional-for-loopsï¼ˆfor-each-å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„-for-å¾ªç¯ï¼‰"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#item-58-prefer-for-each-loops-to-traditional-for-loopsï¼ˆfor-each-å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„-for-å¾ªç¯ï¼‰","aria-hidden":"true"}},[e._v("#")]),e._v(" Item 58: Prefer for-each loops to traditional for loopsï¼ˆfor-each å¾ªç¯ä¼˜äºä¼ ç»Ÿçš„ for å¾ªç¯ï¼‰")]),e._v(" "),o("p",[e._v("As discussed in Item 45, some tasks are best accomplished with streams, others with iteration. Here is a traditional for loop to iterate over a collection:")]),e._v(" "),o("p",[e._v("æ­£å¦‚åœ¨ Item-45 ä¸­æ‰€è®¨è®ºçš„ï¼Œä¸€äº›ä»»åŠ¡æœ€å¥½ä½¿ç”¨æµæ¥å®Œæˆï¼Œå…¶ä»–ä»»åŠ¡æœ€å¥½ä½¿ç”¨ iterationã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ä¸€ä¸ªä¼ ç»Ÿçš„ for å¾ªç¯æ¥éå†ä¸€ä¸ªé›†åˆï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// Not the best way to iterate over a collection!\nfor (Iterator<Element> i = c.iterator(); i.hasNext(); ) {\n    Element e = i.next();\n    ... // Do something with e\n}\n")])])]),o("p",[e._v("and here is a traditional for loop to iterate over an array:")]),e._v(" "),o("p",[e._v("è¿™æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„ for å¾ªç¯æ¥éå†æ•°ç»„ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// Not the best way to iterate over an array!\nfor (int i = 0; i < a.length; i++) {\n    ... // Do something with a[i]\n}\n")])])]),o("p",[e._v("These idioms are better than while loops (Item 57), but they arenâ€™t perfect. The iterator and the index variables are both just clutterâ€”all you need are the elements. Furthermore, they represent opportunities for error. The iterator occurs three times in each loop and the index variable four, which gives you many chances to use the wrong variable. If you do, there is no guarantee that the compiler will catch the problem. Finally, the two loops are quite different, drawing unnecessary attention to the type of the container and adding a (minor) hassle to changing that type.")]),e._v(" "),o("p",[e._v("è¿™äº›ä¹ æƒ¯ç”¨æ³•æ¯” while å¾ªç¯æ›´å¥½ï¼ˆItem-57ï¼‰ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸å®Œç¾ã€‚è¿­ä»£å™¨å’Œç´¢å¼•å˜é‡éƒ½å¾ˆæ··ä¹±ï¼ˆä½ åªéœ€è¦å…ƒç´ ï¼‰ã€‚æ­¤å¤–ï¼Œå®ƒä»¬æœ‰å‡ºé”™çš„å¯èƒ½ã€‚è¿­ä»£å™¨åœ¨æ¯ä¸ªå¾ªç¯ä¸­å‡ºç°ä¸‰æ¬¡ï¼Œç´¢å¼•å˜é‡å‡ºç°å››æ¬¡ï¼Œè¿™ä½¿å¾—æœ‰å¾ˆå¤šæœºä¼šä½¿ç”¨åˆ°é”™è¯¯çš„å˜é‡ã€‚å¦‚æœè¿™æ ·åšï¼Œå°±ä¸èƒ½ä¿è¯ç¼–è¯‘å™¨ä¼šæ•æ‰åˆ°é—®é¢˜ã€‚Finally, the two loops are quite different, drawing unnecessary attention to the type of the container and adding a (minor) hassle to changing that type.")]),e._v(" "),o("p",[e._v("The for-each loop (officially known as the â€œenhanced for statementâ€) solves all of these problems. It gets rid of the clutter and the opportunity for error by hiding the iterator or index variable. The resulting idiom applies equally to collections and arrays, easing the process of switching the implementation type of a container from one to the other:")]),e._v(" "),o("p",[e._v("for-each å¾ªç¯ï¼ˆå®˜æ–¹ç§°ä¸ºã€Œenhanced for è¯­å¥ã€ï¼‰è§£å†³äº†æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚å®ƒé€šè¿‡éšè—è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡æ¥æ¶ˆé™¤æ··ä¹±å’Œå‡ºé”™çš„æœºä¼šã€‚ç”±æ­¤äº§ç”Ÿçš„ä¹ æƒ¯ç”¨æ³•åŒæ ·é€‚ç”¨äºé›†åˆå’Œæ•°ç»„ï¼Œä»è€Œç®€åŒ–äº†å°†å®¹å™¨çš„å®ç°ç±»å‹ä»ä¸€ç§è½¬æ¢ä¸ºå¦ä¸€ç§çš„è¿‡ç¨‹ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// The preferred idiom for iterating over collections and arrays\nfor (Element e : elements) {\n    ... // Do something with e\n}\n")])])]),o("p",[e._v("When you see the colon (ğŸ˜ƒ, read it as â€œin.â€ Thus, the loop above reads as â€œfor each element e in elements.â€ There is no performance penalty for using for-each loops, even for arrays: the code they generate is essentially identical to the code you would write by hand.")]),e._v(" "),o("p",[e._v("å½“ä½ çœ‹åˆ°å†’å· "),o("code",[e._v("(:)")]),e._v(" æ—¶ï¼Œè¯·å°†å…¶è¯»ä½œã€Œinã€ã€‚å› æ­¤ï¼Œä¸Šé¢çš„å¾ªç¯è¯»ä½œã€Œå¯¹å…ƒç´ é›†çš„æ¯ä¸ªå…ƒç´  e è¿›è¡Œæ“ä½œã€ã€‚ä½¿ç”¨ for-each å¾ªç¯ä¸ä¼šé™ä½æ€§èƒ½ï¼Œå¯¹äºæ•°ç»„ä¹Ÿæ˜¯å¦‚æ­¤ï¼šå®ƒä»¬ç”Ÿæˆçš„ä»£ç æœ¬è´¨ä¸Šä¸ä½ æ‰‹å·¥ç¼–å†™çš„ for å¾ªç¯ä»£ç ç›¸åŒã€‚")]),e._v(" "),o("p",[e._v("The advantages of the for-each loop over the traditional for loop are even greater when it comes to nested iteration. Here is a common mistake that people make when doing nested iteration:")]),e._v(" "),o("p",[e._v("å½“æ¶‰åŠåˆ°åµŒå¥—è¿­ä»£æ—¶ï¼Œfor-each å¾ªç¯ç›¸å¯¹äºä¼ ç»Ÿ for å¾ªç¯çš„ä¼˜åŠ¿ç”šè‡³æ›´å¤§ã€‚ä¸‹é¢æ˜¯äººä»¬åœ¨è¿›è¡ŒåµŒå¥—è¿­ä»£æ—¶ç»å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// Can you spot the bug?\nenum Suit { CLUB, DIAMOND, HEART, SPADE }\nenum Rank { ACE, DEUCE, THREE, FOUR, FIVE, SIX, SEVEN, EIGHT,NINE, TEN, JACK, QUEEN, KING }\n...\nstatic Collection<Suit> suits = Arrays.asList(Suit.values());\nstatic Collection<Rank> ranks = Arrays.asList(Rank.values());\nList<Card> deck = new ArrayList<>();\nfor (Iterator<Suit> i = suits.iterator(); i.hasNext(); )\nfor (Iterator<Rank> j = ranks.iterator(); j.hasNext(); )\ndeck.add(new Card(i.next(), j.next()));\n")])])]),o("p",[e._v("Donâ€™t feel bad if you didnâ€™t spot the bug. Many expert programmers have made this mistake at one time or another. The problem is that the next method is called too many times on the iterator for the outer collection (suits). It should be called from the outer loop so that it is called once per suit, but instead it is called from the inner loop, so it is called once per card. After you run out of suits, the loop throws a NoSuchElementException.")]),e._v(" "),o("p",[e._v("å¦‚æœä½ æ²¡æœ‰å‘ç°è¿™ä¸ªbugï¼Œä¸è¦æ„Ÿåˆ°éš¾è¿‡ã€‚è®¸å¤šä¸“ä¸šç¨‹åºå‘˜éƒ½æ›¾çŠ¯è¿‡è¿™æ ·çš„é”™è¯¯ã€‚é—®é¢˜æ˜¯ï¼Œè¿­ä»£å™¨å¯¹å¤–éƒ¨çš„é›†åˆ suits è°ƒç”¨äº†å¤ªå¤šæ¬¡ next æ–¹æ³•ã€‚å®ƒåº”è¯¥ä»å¤–éƒ¨å¾ªç¯è°ƒç”¨ï¼Œå› æ­¤æ¯ç§èŠ±è‰²è°ƒç”¨ä¸€æ¬¡ï¼Œä½†å®ƒæ˜¯ä»å†…éƒ¨å¾ªç¯è°ƒç”¨çš„ï¼Œå› æ­¤æ¯ä¸€å¼ ç‰Œè°ƒç”¨ä¸€æ¬¡ã€‚åœ¨ç”¨å®Œæ‰€æœ‰èŠ±è‰²ä¹‹åï¼Œå¾ªç¯æŠ›å‡º NoSuchElementExceptionã€‚")]),e._v(" "),o("p",[e._v("If youâ€™re really unlucky and the size of the outer collection is a multiple of the size of the inner collectionâ€”perhaps because theyâ€™re the same collectionâ€”the loop will terminate normally, but it wonâ€™t do what you want. For example, consider this ill-conceived attempt to print all the possible rolls of a pair of dice:")]),e._v(" "),o("p",[e._v("å¦‚æœçœŸçš„å¾ˆä¸å¹¸ï¼Œå¤–éƒ¨é›†åˆçš„å¤§å°æ˜¯å†…éƒ¨é›†åˆå¤§å°çš„å‡ å€ï¼ˆå¯èƒ½å› ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„é›†åˆï¼‰ï¼Œå¾ªç¯å°†æ­£å¸¸ç»ˆæ­¢ï¼Œä½†æ˜¯å®ƒä¸ä¼šæ‰§è¡Œä½ æƒ³è¦çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªæ‰“å°ä¸€å¯¹éª°å­æ‰€æœ‰å¯èƒ½çš„ç»„åˆå€¼çš„é”™è¯¯å°è¯•ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('// Same bug, different symptom!\nenum Face { ONE, TWO, THREE, FOUR, FIVE, SIX }\n...\nCollection<Face> faces = EnumSet.allOf(Face.class);\nfor (Iterator<Face> i = faces.iterator(); i.hasNext(); )\nfor (Iterator<Face> j = faces.iterator(); j.hasNext(); )\nSystem.out.println(i.next() + " " + j.next());\n')])])]),o("p",[e._v("The program doesnâ€™t throw an exception, but it prints only the six â€œdoublesâ€ (from â€œONE ONEâ€ to â€œSIX SIXâ€), instead of the expected thirty-six combinations.")]),e._v(" "),o("p",[e._v("ç¨‹åºä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å®ƒåªæ‰“å° 6 ä¸ªé‡å¤æ•°å€¼ï¼ˆä»ã€ŒONE ONEã€åˆ°ã€ŒSIX SIXã€ï¼‰ï¼Œè€Œä¸æ˜¯é¢„æœŸçš„ 36 ä¸ªç»„åˆã€‚")]),e._v(" "),o("p",[e._v("To fix the bugs in these examples, you must add a variable in the scope of the outer loop to hold the outer element:")]),e._v(" "),o("p",[e._v("è¦ä¿®å¤è¿™äº›ä¾‹å­ä¸­çš„é”™è¯¯ï¼Œå¿…é¡»åœ¨å¤–éƒ¨å¾ªç¯çš„ä½œç”¨åŸŸå†…æ·»åŠ ä¸€ä¸ªå˜é‡æ¥ä¿å­˜å¤–éƒ¨å…ƒç´ ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// Fixed, but ugly - you can do better!\nfor (Iterator<Suit> i = suits.iterator(); i.hasNext(); ) {\n    Suit suit = i.next();\n    for (Iterator<Rank> j = ranks.iterator(); j.hasNext(); )\n        deck.add(new Card(suit, j.next()));\n}\n")])])]),o("p",[e._v("If instead you use a nested for-each loop, the problem simply disappears. The resulting code is as succinct as you could wish for:")]),e._v(" "),o("p",[e._v("ç›¸åï¼Œå¦‚æœä½¿ç”¨åµŒå¥— for-each å¾ªç¯ï¼Œé—®é¢˜å°±ä¼šæ¶ˆå¤±ã€‚ç”Ÿæˆçš„ä»£ç æ›´ç®€æ´ï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("// Preferred idiom for nested iteration on collections and arrays\nfor (Suit suit : suits)\nfor (Rank rank : ranks)\ndeck.add(new Card(suit, rank));\n")])])]),o("p",[e._v("Unfortunately, there are three common situations where you canâ€™t use foreach:")]),e._v(" "),o("p",[e._v("ä¸å¹¸çš„æ˜¯ï¼Œæœ‰ä¸‰ç§å¸¸è§çš„æƒ…å†µä½ ä¸åº”ä½¿ç”¨ for-eachï¼š")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Destructive filtering")]),e._v(" â€”If you need to traverse a collection removing selected elements, then you need to use an explicit iterator so that you can call its remove method. You can often avoid explicit traversal by using Collectionâ€™s removeIf method, added in Java 8.")])]),e._v(" "),o("p",[o("strong",[e._v("ç ´åæ€§è¿‡æ»¤")]),e._v("ï¼Œå¦‚æœéœ€è¦éå†ä¸€ä¸ªé›†åˆå¹¶åˆ é™¤é€‰å®šå…ƒç´ ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ˜¾å¼çš„è¿­ä»£å™¨ï¼Œä»¥ä¾¿è°ƒç”¨å…¶ remove æ–¹æ³•ã€‚é€šè¿‡ä½¿ç”¨ Collection åœ¨ Java 8 ä¸­æ·»åŠ çš„ removeIf æ–¹æ³•ï¼Œé€šå¸¸å¯ä»¥é¿å…æ˜¾å¼éå†ã€‚")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Transforming")]),e._v(" â€”If you need to traverse a list or array and replace some or all of the values of its elements, then you need the list iterator or array index in order to replace the value of an element.")])]),e._v(" "),o("p",[o("strong",[e._v("è½¬æ¢")]),e._v("ï¼Œå¦‚æœéœ€è¦éå†ä¸€ä¸ª List æˆ–æ•°ç»„å¹¶æ›¿æ¢å…¶ä¸­éƒ¨åˆ†æˆ–å…¨éƒ¨å…ƒç´ çš„å€¼ï¼Œé‚£ä¹ˆéœ€è¦ List è¿­ä»£å™¨æˆ–æ•°ç»„ç´¢å¼•æ¥æ›¿æ¢å…ƒç´ çš„å€¼ã€‚")]),e._v(" "),o("ul",[o("li",[o("strong",[e._v("Parallel iteration")]),e._v(" â€”If you need to traverse multiple collections in parallel, then you need explicit control over the iterator or index variable so that all iterators or index variables can be advanced in lockstep (as demonstrated unintentionally in the buggy card and dice examples above). If you find yourself in any of these situations, use an ordinary for loop and be wary of the traps mentioned in this item.")])]),e._v(" "),o("p",[o("strong",[e._v("å¹¶è¡Œè¿­ä»£")]),e._v("ï¼Œå¦‚æœéœ€è¦å¹¶è¡Œéå†å¤šä¸ªé›†åˆï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼åœ°æ§åˆ¶è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰è¿­ä»£å™¨æˆ–ç´¢å¼•å˜é‡éƒ½å¯ä»¥åŒæ­¥æ‰§è¡Œï¼ˆå¦‚ä¸Šè¿°ç‰Œå’Œéª°å­ç¤ºä¾‹ä¸­æ— æ„ä¸­æ¼”ç¤ºçš„é”™è¯¯é‚£æ ·ï¼‰ã€‚å¦‚æœå‘ç°è‡ªå·±å¤„äºè¿™äº›æƒ…å†µä¸­çš„ä»»ä½•ä¸€ç§ï¼Œè¯·ä½¿ç”¨æ™®é€šçš„ for å¾ªç¯ï¼Œå¹¶è­¦æƒ•æœ¬æ¡ç›®ä¸­æåˆ°çš„é™·é˜±ã€‚")]),e._v(" "),o("p",[e._v("Not only does the for-each loop let you iterate over collections and arrays, it lets you iterate over any object that implements the Iterable interface, which consists of a single method. Here is how the interface looks:")]),e._v(" "),o("p",[e._v("for-each å¾ªç¯ä¸ä»…å…è®¸éå†é›†åˆå’Œæ•°ç»„ï¼Œè¿˜å…è®¸éå†å®ç° Iterable æ¥å£çš„ä»»ä½•å¯¹è±¡ï¼Œè¯¥æ¥å£ç”±ä¸€ä¸ªæ–¹æ³•ç»„æˆã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("public interface Iterable<E> {\n    // Returns an iterator over the elements in this iterable\n    Iterator<E> iterator();\n}\n")])])]),o("p",[e._v("It is a bit tricky to implement Iterable if you have to write your own Iterator implementation from scratch, but if you are writing a type that represents a group of elements, you should strongly consider having it implement Iterable, even if you choose not to have it implement Collection. This will allow your users to iterate over your type using the foreach loop, and they will be forever grateful.")]),e._v(" "),o("p",[e._v("å¦‚æœå¿…é¡»ä»å¤´å¼€å§‹ç¼–å†™è‡ªå·±çš„ Iterator å®ç°ï¼Œç¡®å®æœ‰ç‚¹æ£˜æ‰‹ï¼Œä½†æ˜¯å¦‚æœæ­£åœ¨ç¼–å†™çš„ç±»å‹è¡¨ç¤ºä¸€ç»„å…ƒç´ ï¼Œå³ä½¿é€‰æ‹©ä¸è®©å®ƒå®ç° Collectionï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥å¼ºçƒˆè€ƒè™‘è®©å®ƒå®ç° Iterableã€‚è¿™å°†å…è®¸ç”¨æˆ·ä½¿ç”¨ foreach å¾ªç¯éå†ç±»å‹ï¼Œä»–ä»¬å°†æ°¸è¿œæ„Ÿæ¿€ä¸å°½ã€‚")]),e._v(" "),o("p",[e._v("In summary, the for-each loop provides compelling advantages over the traditional for loop in clarity, flexibility, and bug prevention, with no performance penalty. Use for-each loops in preference to for loops wherever you can.")]),e._v(" "),o("p",[e._v("æ€»ä¹‹ï¼Œfor-each å¾ªç¯åœ¨æ¸…æ™°åº¦ã€çµæ´»æ€§å’Œ bug é¢„é˜²æ–¹é¢æ¯”ä¼ ç»Ÿçš„ for å¾ªç¯æ›´æœ‰ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ²¡æœ‰æ€§èƒ½æŸå¤±ã€‚å°½å¯èƒ½ä½¿ç”¨ for-each å¾ªç¯è€Œä¸æ˜¯ for å¾ªç¯ã€‚")])])},[],!1,null,null,null);t.default=r.exports}}]);